import{a as D,t as ge,n as ie}from"./disclose-version.KRzaITl4.js";import{a4 as _e,k as ve,_ as pe,aw as be,h as ye,u as we,j as xe,p as ke,au as b,g as t,s as v,al as Se,t as F,e as Ae,A as s,f as y,r as w,J as Me}from"./runtime.DiZcWLR9.js";import{l as Ee,d as Ie,s as ae}from"./render.CK68YWHb.js";import{e as ne,i as oe}from"./each.dRzjpiai.js";import{r as O,s as x}from"./attributes.lB_zpKmd.js";import{s as Pe}from"./class.Zu1lPXJF.js";import{p as S}from"./proxy.Bnq3Z6YO.js";const ze=[];function Te(e,i=!1){return I(e,new Map,"",ze)}function I(e,i,c,g,l=null){if(typeof e=="object"&&e!==null){var o=i.get(e);if(o!==void 0)return o;if(e instanceof Map)return new Map(e);if(e instanceof Set)return new Set(e);if(_e(e)){var f=Array(e.length);i.set(e,f),l!==null&&i.set(l,f);for(var h=0;h<e.length;h+=1){var A=e[h];h in e&&(f[h]=I(A,i,c,g))}return f}if(ve(e)===pe){f={},i.set(e,f),l!==null&&i.set(l,f);for(var u in e)f[u]=I(e[u],i,c,g);return f}if(e instanceof Date)return structuredClone(e);if(typeof e.toJSON=="function")return I(e.toJSON(),i,c,g,e)}if(e instanceof EventTarget)return e;try{return structuredClone(e)}catch{return e}}function V(e,i,c=i){var g=be();Ee(e,"input",l=>{var o=l?e.defaultValue:e.value;if(o=Z(e)?R(o):o,c(o),g&&o!==(o=i())){var f=e.selectionStart,h=e.selectionEnd;e.value=o??"",h!==null&&(e.selectionStart=f,e.selectionEnd=Math.min(h,e.value.length))}}),(ye&&e.defaultValue!==e.value||we(i)==null&&e.value)&&c(Z(e)?R(e.value):e.value),xe(()=>{var l=i();Z(e)&&l===R(e.value)||e.type==="date"&&!l&&!e.value||l!==e.value&&(e.value=l??"")})}function Z(e){var i=e.type;return i==="number"||i==="range"}function R(e){return e===""?null:+e}const Ze={layout:"post",title:"Beam search nearest neighbors",summary:"A visualization of my favorite algorithm",date:"2015-12-28T00:00:00.000Z",updated:"2025-03-12T00:00:00.000Z"};function je(e,i,c){i[t(c)]()}var Be=ie("<circle></circle>"),Ne=ie('<line width="3" stroke="grey"></line>'),We=ge('<p>A common problem is finding the nearest neighbors of a given object in some search space. <a href="https://en.wikipedia.org/wiki/Beam_search" rel="nofollow">Beam search</a> is an “anytime” heuristic search algorithm which very efficiently accomplishes this.</p> <p>Imagine we have a set of N nodes, each randomly “closest” (connected by an edge) to n other nodes. The algorithm works as follows:</p> <ol><li>Pick a node; paint it red.</li> <li>Paint its neighbors grey. Also paint the neighbors for each of those neighbors.</li> <li>“Fix” the edges of the red node by connecting it to the closest of these grey nodes.</li> <li>Repeat for each node.</li></ol> <p>Click to proceed with the algorithm: <button> </button></p> <div class="flex"><div>Number of nodes: <input class="w-8 text-blue-500"></div> <div>Number of neighbors to find: <input class="w-8 text-blue-500"></div> <div> <input class="w-8 text-blue-500"></div></div> <div class="w-full flex justify-center mt-12 mb-32"><svg class="w-full mx-auto" viewBox="0 0 1000 300"><!><!></svg></div>',1);function Re(e,i){ke(i,!0);let c=b(50),g=b(3),l=b(75),o=b(S(new Array(t(c))));const f=1e3,h=300;let A=b(!1),u=b(S({})),G=Me(()=>{const r=[];for(const a in t(u)){const n=parseInt(a),p=t(o)[n];t(u)[a].forEach(m=>{const C=t(o)[m];r.push([p,C])})}return r}),_=b(1e5),M=b(0),H,k=b("Initialize random edges"),se={"Initialize random edges":()=>{K(),s(k,"Solve quickly")},"Solve quickly":()=>{H=Te(t(u)),fe(),s(k,"Wait, slow that down")},"Wait, slow that down":()=>{s(u,S(H)),ue(),s(k,"Wow cool")},"Wow cool":()=>{s(k,"Start over")},"Start over":()=>{s(u,S({})),P(),s(k,"Initialize random edges")}};function P(){s(o,S(new Array(t(c))));for(var r=0;r<t(c);++r)t(o)[r]={x:.1*f+.9*f*Math.random(),y:.05*h+.9*h*Math.random(),r:3,color:"black"}}P();function K(){s(u,S({})),t(o).forEach((r,a)=>{let n=[];ce(t(o),t(g)).forEach(p=>{n.push(p)}),t(u)[a]=n})}function le(r){return Array.from({length:r},(a,n)=>n)}function ce(r,a){return[...le(r.length)].sort(()=>.5-Math.random()).slice(0,a)}function fe(){s(M,0);for(let r=0;r<t(l);r++)L(!0)}function ue(){s(A,!0),s(M,0);let r=0;function a(){r<t(l)?(L(),r++,setTimeout(a,250)):s(A,!1)}a()}function L(r){s(_,S(t(_)>=t(c)-1?0:t(_)+1)),r||z(t(_),{color:"red",r:10}),s(M,t(M)+1);let a=t(u)[t(_)]||[],n=[...new Set(a.flatMap(d=>t(u)[d]||[]).filter(d=>d!==t(_)&&!a.includes(d)))],p=[...a,...n],m=p.map(d=>(r||(z(d,{color:"grey",r:5}),Q(t(_),{color:"black",r:3},50)),de(t(o)[d],t(o)[t(_)]))),C=Array.from({length:m.length},(d,J)=>J).sort((d,J)=>m[d]<m[J]?1:-1).slice(0,t(g));t(u)[t(_)]=C.map(d=>p[d]),r||Q(t(_),{color:"black",r:3},100)}function z(r,a){t(o)[r]={...t(o)[r],...a}}function Q(r,a,n){setTimeout(()=>{z(r,a)},n)}function de(r,a){let n=0;return n+=Math.pow(r.x-a.x,2),n+=Math.pow(r.y-a.y,2),1/(1+Math.sqrt(n))}var U=We(),T=v(Se(U),6),E=v(y(T));E.__click=[je,se,k];var he=y(E,!0);w(E),w(T);var j=v(T,2),B=y(j),N=v(y(B));O(N),N.__change=P,w(B);var W=v(B,2),q=v(y(W));O(q),q.__change=K,w(W);var X=v(W,2),Y=y(X),$=v(Y);O($),w(X),w(j);var ee=v(j,2),te=y(ee),re=y(te);ne(re,17,()=>t(o),oe,(r,a)=>{var n=Be();F(()=>{x(n,"cx",t(a).x),x(n,"cy",t(a).y),x(n,"r",t(a).r),x(n,"fill",t(a).color)}),D(r,n)});var me=v(re);ne(me,17,()=>t(G),oe,(r,a)=>{let n=()=>t(a)[0],p=()=>t(a)[1];var m=Ne();F(()=>{x(m,"x1",n().x),x(m,"x2",p().x),x(m,"y1",n().y),x(m,"y2",p().y)}),D(r,m)}),w(te),w(ee),F(()=>{Pe(E,`px-2 py-1 text-white ${(t(A)?"bg-gray-400":"bg-blue-500 hover:bg-blue-600")??""} rounded  focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 inline-flex items-center`),E.disabled=t(A),ae(he,t(k)),ae(Y,`Iterations: ${t(M)??""} / `)}),V(N,()=>t(c),r=>s(c,r)),V(q,()=>t(g),r=>s(g,r)),V($,()=>t(l),r=>s(l,r)),D(e,U),Ae()}Ie(["click","change"]);export{Re as default,Ze as metadata};
