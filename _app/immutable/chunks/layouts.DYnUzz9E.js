var V=t=>{throw TypeError(t)};var P=(t,e,n)=>e.has(t)||V("Cannot "+n);var y=(t,e,n)=>(P(t,e,"read from private field"),n?n.call(t):e.get(t)),F=(t,e,n)=>e.has(t)?V("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,n),O=(t,e,n,p)=>(P(t,e,"write to private field"),p?p.call(t,n):e.set(t,n),n);import{a as R,t as ys,n as J}from"./disclose-version.BNO5E3CA.js";import{a8 as ss,j as hs,J as v,g as l,p as ds,av as W,s as x,w as es,t as X,e as Es,f as S,r as j,o as us}from"./runtime.CUXqFQnj.js";import{d as fs,s as ts}from"./render.BtvPVHjT.js";import{i as Fs}from"./if.CpqPPbvx.js";import{e as as,i as os}from"./each.Cow71Dm7.js";import{h as ns}from"./html.CIg2DK7T.js";import{s as g}from"./attributes.B3mHJc4L.js";import{p as m}from"./proxy.DencPW26.js";import{r as gs,l as ms}from"./loop.BGGTUj09.js";import{i as rs}from"./utils.vK_o3JBb.js";function Cs(t){return t}function $(t,e){if(t===e||t!==t)return()=>t;const n=typeof t;if(n!==typeof e||Array.isArray(t)!==Array.isArray(e))throw new Error("Cannot interpolate values of different type");if(Array.isArray(t)){const p=e.map((d,i)=>$(t[i],d));return d=>p.map(i=>i(d))}if(n==="object"){if(!t||!e)throw new Error("Object cannot be null");if(rs(t)&&rs(e)){const i=t.getTime(),E=e.getTime()-i;return D=>new Date(i+D*E)}const p=Object.keys(e),d={};return p.forEach(i=>{d[i]=$(t[i],e[i])}),i=>{const w={};return p.forEach(E=>{w[E]=d[E](i)}),w}}if(n==="number"){const p=e-t;return d=>t+d*p}throw new Error(`Cannot interpolate ${n} values`)}var C,k,I,A;const q=class q{constructor(e,n={}){F(this,C,ss(void 0));F(this,k,ss(void 0));F(this,I);F(this,A,null);y(this,C).v=y(this,k).v=e,O(this,I,n)}static of(e,n){const p=new q(e(),n);return hs(()=>{p.set(e())}),p}set(e,n){v(y(this,k),e);let p=y(this,C).v,d=y(this,A),i=!1,{delay:w=0,duration:E=400,easing:D=Cs,interpolate:N=$}={...y(this,I),...n};const u=gs.now()+w;let r;return O(this,A,ms(L=>{if(L<u)return!0;i||(i=!0,r=N(p,e),typeof E=="function"&&(E=E(p,e)),d==null||d.abort());const b=L-u;return b>E?(v(y(this,C),e),!1):(v(y(this,C),r(D(b/E))),!0)})),y(this,A).promise}get current(){return l(y(this,C))}get target(){return l(y(this,k))}set target(e){this.set(e)}};C=new WeakMap,k=new WeakMap,I=new WeakMap,A=new WeakMap;let Y=q;const Ls={title:"Layouts",summary:"Some of the coolest algorithms you use everyday without knowing it",date:"2025-03-28T00:00:00.000Z"};var ws=J("<text> </text>"),xs=J('<line stroke="black" stroke-width=".75" marker-end="url(#arrowhead2)"></line>'),vs=J('<defs><marker id="arrowhead2" markerWidth="4" markerHeight="5" refX="3" refY="2.5" orient="auto"><polygon points="0 0, 4 2.5, 0 5"></polygon></marker></defs><!>',1),Ds=ys('<p>A layout algorithm is a structured approach to rendering information: specifically it solves the problem of <em>where do things go</em>.</p> <p>You’re looking at a web page right now organized by layout algorithms that implement the <a href="https://developer.mozilla.org/en-US/docs/Learn_web_development/Core/Styling_basics/Box_model" rel="nofollow">CSS Box Model</a>. This page benefits from layout tree construction, box size calculation, flow layout algorithms and positioning algorithms.</p> <p>I find layout algorithms really interesting. They drive so much of how we interact with the digital world, and when they work well they seem amost magical.</p> <p>So I thought today I’d take a look at a class of layout algorithms called <em>hierarchical</em> layout algorithms. These represent information that can be encoded in a graph, like a tree or diagram.</p> <p>The problem is, given a set of nodes and edges:</p> <!> <p>How do we generate something like this?</p> <svg class="w-1/2 mx-auto" viewBox="30 0 250 80"><defs><marker id="arrowhead" markerWidth="6" markerHeight="7" refX="4" refY="3.5" orient="auto"><polygon points="0 0, 6 3.5, 0 7"></polygon></marker></defs><text x="50" y="50" font-size="20">🐄</text><text x="150" y="50" font-size="20">🥛</text><text x="250" y="20" font-size="20">🧀</text><text x="250" y="80" font-size="20">🧈</text><line x1="85" y1="45" x2="135" y2="45" style="stroke:rgb(0,0,0);stroke-width:2" marker-end="url(#arrowhead)"></line><line x1="185" y1="45" x2="235" y2="25" style="stroke:rgb(0,0,0);stroke-width:2" marker-end="url(#arrowhead)"></line><line x1="185" y1="45" x2="235" y2="65" style="stroke:rgb(0,0,0);stroke-width:2" marker-end="url(#arrowhead)"></line></svg> <p>Drawing the diagram is easy enough in javascript if you know the coordinates— but how do you know the right coordinates?</p> <p>The industry standard is something called <a href="https://en.wikipedia.org/wiki/Layered_graph_drawing" rel="nofollow">Sugiyama</a>, but implementing it can be thousands of lines of code— see the Javascript implementation, <a href="https://github.com/dagrejs/dagre" rel="nofollow">Dagre</a>, for more on that.</p> <p>Because of space and brain constraints, we’ll look at a common simpler option: the <a href="https://reingold.co/tidier-drawings.pdf" rel="nofollow">Reingold-Tilford algorithm</a>.</p> <h2>Reingold-Tilford</h2> <p>Reingold-Tilford requires us to do four passes over the data:</p> <ol><li>Assign initial coordinates</li> <li>Resolve conflicts between subtrees</li> <li>Apply modifiers to the final coordinates</li> <li>Normalize coordinates</li></ol> <p>Before we do the first step we need to construct a Tree structure:</p> <!> <p>Then assigning initial coordinates is as simple as walking through the tree recursively and</p> <ol><li>Calculate the depth of each node</li> <li>Calculate a position that is in the center of its children</li></ol> <p>Let’s walk through the steps.</p> <span class="bg-gray-200"></span> <div class="flex gap-6"><svg class="flex-grow"><!><!></svg> <div class="w-1/3"><p class="text-yellow-400"> </p> <button class="px-2 py-1 text-white rounded bg-yellow-500">click here</button></div></div> <p>and that’s pretty much sufficient for a really simple tree like this one!</p> <p>If you click to try it again, we’ll redo the same example but with 6 extra items and 10 additional edges. You’ll see that because of items having parents at multiple depths, it can be tricky to get a pleasing layout.</p> <p>In another post (or maybe just extending this one in the future) we’ll look at the solution: resolving conflicts with modifiers and normalizing coordinates, and maybe arrows.</p>',1);function Rs(t,e){var B,T,z;ds(e,!0);class n{constructor(s){F(this,B,W(m(new Y(0))));F(this,T,W(m(new Y(0))));F(this,z,W(0));this.value=s,this.children=[]}get x(){return l(y(this,B))}set x(s){v(y(this,B),m(s))}get y(){return l(y(this,T))}set y(s){v(y(this,T),m(s))}get mod(){return l(y(this,z))}set mod(s){v(y(this,z),m(s))}addChild(s){return this.children.push(s),s}}B=new WeakMap,T=new WeakMap,z=new WeakMap;const p=(a,s=0,o=30)=>{a.y.target=s*o,a.children.forEach(h=>{p(h,h.y.target/o+s+1,o)})},d=(a,s,o)=>{a.x.target=s,s+=o,a.children.forEach((h,c)=>{d(h,s*(c+1),o)})},i=a=>{a.children.forEach(h=>{i(h)});const s=a.children[0],o=a.children[a.children.length-1];s&&(a.x.target=(s.x.target+o.x.target)/2)},w={nodes:["🐄","🥛","🧀","🧈"],edges:[{in:"🐄",out:"🥛"},{in:"🥛",out:"🧀"},{in:"🥛",out:"🧈"}]};function E(a){const s=new Map;a.nodes.forEach(c=>{s.set(c,new n(c))});const o=new Set;a.edges.forEach(c=>{const f=s.get(c.in),Q=s.get(c.out);f&&Q&&(f.addChild(Q),o.add(c.out))});let h=null;for(const c of a.nodes)if(!o.has(c)){h=s.get(c);break}return h}function D(a){let s=[a];for(const o of a.children)for(const h of D(o))s.push(h);return s}function N(a){let s=[];for(const o of a.children){s.push({from:{x:a.x.target,y:a.y.target},to:{x:o.x.target,y:o.y.target},parent:a,child:o});const h=N(o);s=s.concat(h)}return s}let u=W(m(E(w))),r=m({current:0,finished:!1,text:"We start with our nodes all piled up on top of each other. The first step is to calculate *depth*.",steps:{0:()=>{p(l(u)),r.current++,r.text="We start with the root node and walk the tree, adding a bit of height for each level of the tree."},1:()=>{d(l(u),0,20),r.current++,r.text="Then we walk the tree to space out the nodes in a naive way: every element goes a little bit further right than the last one."},2:()=>{i(l(u)),r.current++,r.text="Then we go back and put each node in the middle of its children, giving an orderly appearance to the layout."},3:()=>{r.current++,r.text="Add some arrows and voila, we have a reasonable simple layout."},4:()=>{r.current++,r.text="Start over?"},5:()=>{r.current=0,r.finished=!0,v(u,m(E(L))),r.text="Let's make it a little harder"}}});const L={nodes:["🐄","🥛","🧀","🧈","🍦","🍕","🥞","🎂","🥪"],edges:[{in:"🐄",out:"🥛"},{in:"🥛",out:"🧀"},{in:"🥛",out:"🧈"},{in:"🥛",out:"🍦"},{in:"🧀",out:"🍕"},{in:"🧈",out:"🥞"},{in:"🧈",out:"🎂"},{in:"🧀",out:"🥪"},{in:"🍦",out:"🎂"},{in:"🐄",out:"🧈"},{in:"🐄",out:"🧀"},{in:"🧀",out:"🎂"},{in:"🥛",out:"🥪"},{in:"🍦",out:"🥞"}]};var b=Ds(),U=x(es(b),10);ns(U,()=>`<pre class="shiki nord" style="background-color:#2e3440ff;color:#d8dee9ff" tabindex="0"><code><span class="line"><span style="color:#ECEFF4">&#123;</span></span>
<span class="line"><span style="color:#D8DEE9FF">    nodes</span><span style="color:#ECEFF4">:</span><span style="color:#D8DEE9FF"> [</span><span style="color:#ECEFF4">"</span><span style="color:#A3BE8C">🐄</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">,</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">🥛</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">,</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">🧀</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">,</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">🧈</span><span style="color:#ECEFF4">"</span><span style="color:#D8DEE9FF">]</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#D8DEE9FF">    edges</span><span style="color:#ECEFF4">:</span><span style="color:#D8DEE9FF"> [</span></span>
<span class="line"><span style="color:#ECEFF4">        &#123;</span><span style="color:#88C0D0">in</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">🐄</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">,</span><span style="color:#88C0D0"> out</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">🥛</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">&#125;,</span></span>
<span class="line"><span style="color:#ECEFF4">        &#123;</span><span style="color:#88C0D0">in</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">🥛</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">,</span><span style="color:#88C0D0"> out</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">🧀</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">&#125;,</span></span>
<span class="line"><span style="color:#ECEFF4">        &#123;</span><span style="color:#88C0D0">in</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">🥛</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">,</span><span style="color:#88C0D0"> out</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">🧈</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">&#125;,</span></span>
<span class="line"><span style="color:#D8DEE9FF">    ]</span></span>
<span class="line"><span style="color:#ECEFF4">&#125;</span></span></code></pre>`);var Z=x(U,20);ns(Z,()=>`<pre class="shiki nord" style="background-color:#2e3440ff;color:#d8dee9ff" tabindex="0"><code><span class="line"><span style="color:#81A1C1">class</span><span style="color:#8FBCBB"> TreeNode</span><span style="color:#ECEFF4"> &#123;</span></span>
<span class="line"><span style="color:#81A1C1">        constructor</span><span style="color:#ECEFF4">(</span><span style="color:#D8DEE9">value</span><span style="color:#ECEFF4">)</span><span style="color:#ECEFF4"> &#123;</span></span>
<span class="line"><span style="color:#81A1C1">            this</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">value</span><span style="color:#81A1C1"> =</span><span style="color:#D8DEE9"> value</span><span style="color:#81A1C1">;</span></span>
<span class="line"><span style="color:#81A1C1">            this</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">children</span><span style="color:#81A1C1"> =</span><span style="color:#D8DEE9FF"> []</span><span style="color:#81A1C1">;</span></span>
<span class="line"><span style="color:#81A1C1">            this</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">x</span><span style="color:#81A1C1"> =</span><span style="color:#B48EAD"> 0</span><span style="color:#81A1C1">;</span><span style="color:#616E88">  // x-coordinate for drawing</span></span>
<span class="line"><span style="color:#81A1C1">            this</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">y</span><span style="color:#81A1C1"> =</span><span style="color:#B48EAD"> 0</span><span style="color:#81A1C1">;</span><span style="color:#616E88">  // y-coordinate for drawing</span></span>
<span class="line"><span style="color:#81A1C1">            this</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">mod</span><span style="color:#81A1C1"> =</span><span style="color:#B48EAD"> 0</span><span style="color:#81A1C1">;</span><span style="color:#616E88"> // modifier for shifting subtrees</span></span>
<span class="line"><span style="color:#ECEFF4">        &#125;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0">        addChild</span><span style="color:#ECEFF4">(</span><span style="color:#D8DEE9">child</span><span style="color:#ECEFF4">)</span><span style="color:#ECEFF4"> &#123;</span></span>
<span class="line"><span style="color:#81A1C1">            this</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">children</span><span style="color:#ECEFF4">.</span><span style="color:#88C0D0">push</span><span style="color:#D8DEE9FF">(</span><span style="color:#D8DEE9">child</span><span style="color:#D8DEE9FF">)</span><span style="color:#81A1C1">;</span></span>
<span class="line"><span style="color:#81A1C1">            return</span><span style="color:#D8DEE9"> child</span><span style="color:#81A1C1">;</span></span>
<span class="line"><span style="color:#ECEFF4">        &#125;</span></span>
<span class="line"><span style="color:#ECEFF4">    &#125;</span></span></code></pre>`);var G=x(Z,10),_=S(G),H=S(_);as(H,17,()=>D(l(u)),os,(a,s)=>{var o=ws(),h=S(o,!0);j(o),X(()=>{g(o,"x",l(s).x.current),g(o,"y",l(s).y.current),ts(h,l(s).value)}),R(a,o)});var ls=x(H);{var ps=a=>{var s=vs(),o=x(es(s));as(o,17,()=>N(l(u)),os,(h,c)=>{var f=xs();X(()=>{g(f,"x1",l(c).to.x==60?70:l(c).to.x<70?65:75),g(f,"y1",l(c).from.y+6),g(f,"x2",l(c).to.x==60?70:l(c).to.x<70?55:85),g(f,"y2",l(c).to.y-15)}),R(h,f)}),R(a,s)};Fs(ls,a=>{r.current>3&&!r.finished&&a(ps)})}j(_);var K=x(_,2),M=S(K),is=S(M,!0);j(M);var cs=x(M,2);cs.__click=function(...a){var s;(s=r.steps[r.current])==null||s.apply(this,a)},j(K),j(G),us(6),X(()=>{g(_,"style",`height: ${(r.finished?45:15)??""}rem;`),g(_,"viewBox",`0 -50 100 ${(r.finished?700:150)??""}`),ts(is,r.text)}),R(t,b),Es()}fs(["click"]);export{Rs as default,Ls as metadata};
