<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" href="../favicon.png" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		
		<link href="../_app/immutable/assets/0.BQYHAoAi.css" rel="stylesheet">
		<link href="../_app/immutable/assets/5.BidhpuIP.css" rel="stylesheet">
		<link href="../_app/immutable/assets/farkle.BopMSokE.css" rel="stylesheet">
		<link rel="modulepreload" href="../_app/immutable/entry/start.D98JGyVI.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/entry.DiszH96Z.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/runtime.bkAFKJgj.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/control.CYgJF_JY.js">
		<link rel="modulepreload" href="../_app/immutable/entry/app.DBhn532W.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/preload-helper.C1FmrZbK.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/render.VnJAW1R7.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/misc.B9QI8j-U.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/disclose-version.COxdfNiN.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/if.BKBFJWTL.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/proxy.CQPsOVN2.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/this.CKB_P3bd.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/props.ek4_IpVt.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/store.BsSpNLuv.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/index-client.DCCAqnLN.js">
		<link rel="modulepreload" href="../_app/immutable/nodes/0.DGHKs84y.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/snippet.RD5MGzTg.js">
		<link rel="modulepreload" href="../_app/immutable/nodes/2.COsTIrPz.js">
		<link rel="modulepreload" href="../_app/immutable/nodes/5.i4Vg7zgr.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/attributes.B0y3oGGG.js"><!--[--><meta data-key="description" name="description"> <meta property="og:type" content="article"> <meta property="og:title" content="Pipeable data in Ruby"> <meta name="twitter:title" content="Pipeable data in Ruby"> <meta property="og:description"> <meta name="twitter:description"> <meta property="og:image:width"> <meta property="og:image:height"><!--]--><title>Pipeable data in Ruby</title>
	</head>
	<body data-sveltekit-preload-data="hover">
		<div style="display: contents"><!--[--><!--[--><!----><!--[--><!----><!----><article class="tracking-wide prose mx-auto mt-16 prose-a:text-twirl prose-pre:border prose-pre:border-neutral-700 prose-img:rounded-xl prose-figcaption:lg:-ml-[5ch] prose-figcaption:lg:max-w-[75ch] prose-img:lg:-ml-[5ch] prose-img:lg:max-w-[90ch] px-8 lg:max-w-[85ch] mb-16 svelte-186u6n8"><a href="/blog" class="text-gray-500 hover:text-gray-700">← Back</a> <img class="cover-image" alt="" style="aspect-ratio:  / ;"> <div class="flex gap-2 text-sm">December 27, 2015</div> <h1 class="text-5xl font-[400] text-purple mt-6 mb-12">Pipeable data in Ruby</h1> <p>This post comes from some playing around after seeing Hadley Wickham speak about <a href="https://speakerdeck.com/hadley/pipelines-for-data-analysis-in-r" rel="nofollow">pipeable data in R</a>. In it I try to explore different ways of serially applying a set of transformations to a piece of data.</p> <p>Say we want to tell a story like the following:</p> <blockquote><p>“the bunny Foofoo went to the forest and ate some grass”</p></blockquote> <p>We build up the pieces to tell the story:</p> <!----><pre class="shiki nord" style="background-color:#2e3440ff;color:#d8dee9ff" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="color:#81A1C1">def</span><span style="color:#88C0D0"> the_bunny</span><span style="color:#ECEFF4">(</span><span style="color:#D8DEE9">name</span><span style="color:#ECEFF4">)</span></span>
<span class="line"><span style="color:#ECEFF4">  "</span><span style="color:#A3BE8C">The bunny </span><span style="color:#81A1C1">#&#123;</span><span style="color:#A3BE8C">name</span><span style="color:#81A1C1">&#125;</span><span style="color:#ECEFF4">"</span></span>
<span class="line"><span style="color:#81A1C1">end</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1">def</span><span style="color:#88C0D0"> went_to_the_forest</span><span style="color:#ECEFF4">(</span><span style="color:#D8DEE9">object</span><span style="color:#ECEFF4">)</span></span>
<span class="line"><span style="color:#ECEFF4">  "</span><span style="color:#81A1C1">#&#123;</span><span style="color:#A3BE8C">object</span><span style="color:#81A1C1">&#125;</span><span style="color:#A3BE8C"> went to the forest</span><span style="color:#ECEFF4">"</span></span>
<span class="line"><span style="color:#81A1C1">end</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1">def</span><span style="color:#88C0D0"> and_ate_some_grass</span><span style="color:#ECEFF4">(</span><span style="color:#D8DEE9">object</span><span style="color:#ECEFF4">)</span></span>
<span class="line"><span style="color:#ECEFF4">  "</span><span style="color:#81A1C1">#&#123;</span><span style="color:#A3BE8C">object</span><span style="color:#81A1C1">&#125;</span><span style="color:#A3BE8C"> and ate some grass</span><span style="color:#ECEFF4">"</span></span>
<span class="line"><span style="color:#81A1C1">end</span></span>
<span class="line"></span></code></pre><!----> <p>And then what? We have some choices.</p> <p>Use nested function calls:</p> <!----><pre class="shiki nord" style="background-color:#2e3440ff;color:#d8dee9ff" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="color:#D8DEE9FF">story </span><span style="color:#81A1C1">=</span><span style="color:#D8DEE9FF"> and_ate_some_grass</span><span style="color:#ECEFF4">(</span><span style="color:#D8DEE9FF">went_to_the_forest</span><span style="color:#ECEFF4">(</span><span style="color:#D8DEE9FF">the_bunny</span><span style="color:#ECEFF4">(</span><span style="color:#ECEFF4">'</span><span style="color:#A3BE8C">Foofoo</span><span style="color:#ECEFF4">'</span><span style="color:#ECEFF4">)))</span></span>
<span class="line"></span></code></pre><!----> <p>But this is hard to read. What if we broke it out?</p> <p>Use separate variables for each state:</p> <!----><pre class="shiki nord" style="background-color:#2e3440ff;color:#d8dee9ff" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="color:#D8DEE9FF">the_named_bunny </span><span style="color:#81A1C1">=</span><span style="color:#D8DEE9FF"> the_bunny</span><span style="color:#ECEFF4">(</span><span style="color:#ECEFF4">'</span><span style="color:#A3BE8C">Foofoo</span><span style="color:#ECEFF4">'</span><span style="color:#ECEFF4">)</span></span>
<span class="line"><span style="color:#D8DEE9FF">with_subject </span><span style="color:#81A1C1">=</span><span style="color:#D8DEE9FF"> went_to_the_forest</span><span style="color:#ECEFF4">(</span><span style="color:#D8DEE9FF">the_named_bunny</span><span style="color:#ECEFF4">)</span></span>
<span class="line"><span style="color:#D8DEE9FF">story </span><span style="color:#81A1C1">=</span><span style="color:#D8DEE9FF"> and_ate_some_grass</span><span style="color:#ECEFF4">(</span><span style="color:#D8DEE9FF">with_subject</span><span style="color:#ECEFF4">)</span></span>
<span class="line"></span></code></pre><!----> <p>Not much better. The variable names are either redundant with the
method names or non descriptive.</p> <p>Let’s try using one variable to hold the story as it builds:</p> <!----><pre class="shiki nord" style="background-color:#2e3440ff;color:#d8dee9ff" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="color:#D8DEE9FF">story </span><span style="color:#81A1C1">=</span><span style="color:#D8DEE9FF"> the_bunny</span><span style="color:#ECEFF4">(</span><span style="color:#ECEFF4">'</span><span style="color:#A3BE8C">Foofoo</span><span style="color:#ECEFF4">'</span><span style="color:#ECEFF4">)</span></span>
<span class="line"><span style="color:#D8DEE9FF">story </span><span style="color:#81A1C1">=</span><span style="color:#D8DEE9FF"> went_to_the_forest</span><span style="color:#ECEFF4">(</span><span style="color:#D8DEE9FF">story</span><span style="color:#ECEFF4">)</span></span>
<span class="line"><span style="color:#D8DEE9FF">story </span><span style="color:#81A1C1">=</span><span style="color:#D8DEE9FF"> and_ate_some_grass</span><span style="color:#ECEFF4">(</span><span style="color:#D8DEE9FF">story</span><span style="color:#ECEFF4">)</span></span>
<span class="line"></span></code></pre><!----> <p>This is better, but contrived looking with ‘story’ repeated everywhere. What if we want to tell the same story several times with a different name? We’d have to copy and paste all three lines.</p> <p>So we make a method:</p> <!----><pre class="shiki nord" style="background-color:#2e3440ff;color:#d8dee9ff" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="color:#81A1C1">def</span><span style="color:#88C0D0"> tell_the_story</span><span style="color:#ECEFF4">(</span><span style="color:#D8DEE9">name</span><span style="color:#ECEFF4">)</span></span>
<span class="line"><span style="color:#D8DEE9FF">  story </span><span style="color:#81A1C1">=</span><span style="color:#D8DEE9FF"> the_bunny</span><span style="color:#ECEFF4">(</span><span style="color:#D8DEE9FF">name</span><span style="color:#ECEFF4">)</span></span>
<span class="line"><span style="color:#D8DEE9FF">  story </span><span style="color:#81A1C1">=</span><span style="color:#D8DEE9FF"> went_to_the_forest</span><span style="color:#ECEFF4">(</span><span style="color:#D8DEE9FF">story</span><span style="color:#ECEFF4">)</span></span>
<span class="line"><span style="color:#D8DEE9FF">  story </span><span style="color:#81A1C1">=</span><span style="color:#D8DEE9FF"> and_ate_some_grass</span><span style="color:#ECEFF4">(</span><span style="color:#D8DEE9FF">story</span><span style="color:#ECEFF4">)</span></span>
<span class="line"><span style="color:#D8DEE9FF">  story</span></span>
<span class="line"><span style="color:#81A1C1">end</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9FF">tell_the_story</span><span style="color:#ECEFF4">(</span><span style="color:#ECEFF4">'</span><span style="color:#A3BE8C">Foofoo</span><span style="color:#ECEFF4">'</span><span style="color:#ECEFF4">)</span></span>
<span class="line"><span style="color:#D8DEE9FF">tell_the_story</span><span style="color:#ECEFF4">(</span><span style="color:#ECEFF4">'</span><span style="color:#A3BE8C">Booboo</span><span style="color:#ECEFF4">'</span><span style="color:#ECEFF4">)</span></span>
<span class="line"></span></code></pre><!----> <p>Which is great, but what if you want the option to just use a piece of your story?</p> <!----><pre class="shiki nord" style="background-color:#2e3440ff;color:#d8dee9ff" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="color:#81A1C1">def</span><span style="color:#88C0D0"> partial_story</span><span style="color:#ECEFF4">(</span><span style="color:#D8DEE9">name</span><span style="color:#ECEFF4">)</span></span>
<span class="line"><span style="color:#D8DEE9FF">  story </span><span style="color:#81A1C1">=</span><span style="color:#D8DEE9FF"> the_bunny</span><span style="color:#ECEFF4">(</span><span style="color:#D8DEE9FF">name</span><span style="color:#ECEFF4">)</span></span>
<span class="line"><span style="color:#D8DEE9FF">  story </span><span style="color:#81A1C1">=</span><span style="color:#D8DEE9FF"> went_to_the_forest</span><span style="color:#ECEFF4">(</span><span style="color:#D8DEE9FF">story</span><span style="color:#ECEFF4">)</span></span>
<span class="line"><span style="color:#D8DEE9FF">  story</span></span>
<span class="line"><span style="color:#81A1C1">end</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1">def</span><span style="color:#88C0D0"> full_story</span><span style="color:#ECEFF4">(</span><span style="color:#D8DEE9">name</span><span style="color:#ECEFF4">)</span></span>
<span class="line"><span style="color:#D8DEE9FF">  story </span><span style="color:#81A1C1">=</span><span style="color:#D8DEE9FF"> partial_story</span><span style="color:#ECEFF4">(</span><span style="color:#D8DEE9FF">name</span><span style="color:#ECEFF4">)</span></span>
<span class="line"><span style="color:#D8DEE9FF">  story </span><span style="color:#81A1C1">=</span><span style="color:#D8DEE9FF"> and_ate_some_grass</span><span style="color:#ECEFF4">(</span><span style="color:#D8DEE9FF">story</span><span style="color:#ECEFF4">)</span></span>
<span class="line"><span style="color:#D8DEE9FF">  story</span></span>
<span class="line"><span style="color:#81A1C1">end</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9FF">partial_story</span><span style="color:#ECEFF4">(</span><span style="color:#ECEFF4">'</span><span style="color:#A3BE8C">Foofoo</span><span style="color:#ECEFF4">'</span><span style="color:#ECEFF4">)</span></span>
<span class="line"><span style="color:#D8DEE9FF">full_story</span><span style="color:#ECEFF4">(</span><span style="color:#ECEFF4">'</span><span style="color:#A3BE8C">Booboo</span><span style="color:#ECEFF4">'</span><span style="color:#ECEFF4">)</span></span>
<span class="line"></span></code></pre><!----> <p>Ugh. What if there are many possible sub stories?</p> <p>Maybe use lambdas with a pipeline:</p> <!----><pre class="shiki nord" style="background-color:#2e3440ff;color:#d8dee9ff" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="color:#D8DEE9FF">storyline </span><span style="color:#81A1C1">=</span><span style="color:#ECEFF4"> [</span></span>
<span class="line"><span style="color:#ECEFF4">  :</span><span style="color:#D8DEE9FF">the_bunny</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#ECEFF4">  :</span><span style="color:#D8DEE9FF">went_to_the_forest</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#ECEFF4">  :</span><span style="color:#D8DEE9FF">and_ate_some_grass</span></span>
<span class="line"><span style="color:#ECEFF4">].</span><span style="color:#D8DEE9FF">map</span><span style="color:#ECEFF4">(</span><span style="color:#81A1C1">&#x26;</span><span style="color:#D8DEE9FF">method</span><span style="color:#ECEFF4">(:</span><span style="color:#D8DEE9FF">method</span><span style="color:#ECEFF4">))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9FF">storyline</span><span style="color:#ECEFF4">[</span><span style="color:#B48EAD">0</span><span style="color:#ECEFF4">..</span><span style="color:#B48EAD">1</span><span style="color:#ECEFF4">].</span><span style="color:#D8DEE9FF">inject</span><span style="color:#ECEFF4">(</span><span style="color:#ECEFF4">'</span><span style="color:#A3BE8C">Foofoo</span><span style="color:#ECEFF4">'</span><span style="color:#ECEFF4">)</span><span style="color:#ECEFF4"> &#123;</span><span style="color:#ECEFF4"> |</span><span style="color:#D8DEE9">v</span><span style="color:#ECEFF4">,</span><span style="color:#D8DEE9"> m</span><span style="color:#ECEFF4">|</span><span style="color:#D8DEE9FF"> m</span><span style="color:#ECEFF4">.(</span><span style="color:#D8DEE9FF">v</span><span style="color:#ECEFF4">)</span><span style="color:#ECEFF4"> &#125;</span></span>
<span class="line"><span style="color:#D8DEE9FF">storyline</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9FF">inject</span><span style="color:#ECEFF4">(</span><span style="color:#ECEFF4">'</span><span style="color:#A3BE8C">Booboo</span><span style="color:#ECEFF4">'</span><span style="color:#ECEFF4">)</span><span style="color:#ECEFF4"> &#123;</span><span style="color:#ECEFF4"> |</span><span style="color:#D8DEE9">v</span><span style="color:#ECEFF4">,</span><span style="color:#D8DEE9"> m</span><span style="color:#ECEFF4">|</span><span style="color:#D8DEE9FF"> m</span><span style="color:#ECEFF4">.(</span><span style="color:#D8DEE9FF">v</span><span style="color:#ECEFF4">)</span><span style="color:#ECEFF4"> &#125;</span></span>
<span class="line"></span></code></pre><!----> <p>Ruby syntax starts getting in the way. We can at least hide it away:</p> <!----><pre class="shiki nord" style="background-color:#2e3440ff;color:#d8dee9ff" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="color:#81A1C1">def</span><span style="color:#88C0D0"> tell_the_story</span><span style="color:#ECEFF4">(</span><span style="color:#D8DEE9">storyline</span><span style="color:#D8DEE9FF">, </span><span style="color:#D8DEE9">name</span><span style="color:#ECEFF4">)</span></span>
<span class="line"><span style="color:#D8DEE9FF">  storyline</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9FF">inject</span><span style="color:#ECEFF4">(</span><span style="color:#D8DEE9FF">name</span><span style="color:#ECEFF4">)</span><span style="color:#ECEFF4"> &#123;</span><span style="color:#ECEFF4"> |</span><span style="color:#D8DEE9">v</span><span style="color:#ECEFF4">,</span><span style="color:#D8DEE9"> m</span><span style="color:#ECEFF4">|</span><span style="color:#D8DEE9FF"> m</span><span style="color:#ECEFF4">.(</span><span style="color:#D8DEE9FF">v</span><span style="color:#ECEFF4">)</span><span style="color:#ECEFF4"> &#125;</span></span>
<span class="line"><span style="color:#81A1C1">end</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9FF">tell_the_story</span><span style="color:#ECEFF4">(</span><span style="color:#D8DEE9FF">storyline</span><span style="color:#ECEFF4">[</span><span style="color:#B48EAD">0</span><span style="color:#ECEFF4">..</span><span style="color:#B48EAD">1</span><span style="color:#ECEFF4">],</span><span style="color:#ECEFF4"> '</span><span style="color:#A3BE8C">Foofoo</span><span style="color:#ECEFF4">'</span><span style="color:#ECEFF4">)</span></span>
<span class="line"><span style="color:#D8DEE9FF">tell_the_story</span><span style="color:#ECEFF4">(</span><span style="color:#D8DEE9FF">storyline</span><span style="color:#ECEFF4">,</span><span style="color:#ECEFF4"> '</span><span style="color:#A3BE8C">Booboo</span><span style="color:#ECEFF4">'</span><span style="color:#ECEFF4">)</span></span>
<span class="line"></span></code></pre><!----> <p>But this is still sort of all over the place. We can tidy it up by wrapping it in a class:</p> <!----><pre class="shiki nord" style="background-color:#2e3440ff;color:#d8dee9ff" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="color:#81A1C1">class</span><span style="color:#8FBCBB"> Bunny</span></span>
<span class="line"><span style="color:#81A1C1">  def</span><span style="color:#88C0D0"> initialize</span><span style="color:#ECEFF4">(</span><span style="color:#D8DEE9">name</span><span style="color:#ECEFF4">)</span></span>
<span class="line"><span style="color:#81A1C1">    @</span><span style="color:#D8DEE9">story</span><span style="color:#81A1C1"> =</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">The bunny </span><span style="color:#81A1C1">#&#123;</span><span style="color:#A3BE8C">name</span><span style="color:#81A1C1">&#125;</span><span style="color:#ECEFF4">"</span></span>
<span class="line"><span style="color:#81A1C1">  end</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1">  def</span><span style="color:#88C0D0"> went_to_the_forest</span></span>
<span class="line"><span style="color:#81A1C1">    @</span><span style="color:#D8DEE9">story</span><span style="color:#81A1C1"> +=</span><span style="color:#ECEFF4"> '</span><span style="color:#A3BE8C"> went to the forest</span><span style="color:#ECEFF4">'</span></span>
<span class="line"><span style="color:#81A1C1">    self</span></span>
<span class="line"><span style="color:#81A1C1">  end</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1">  def</span><span style="color:#88C0D0"> and_ate_some_grass</span></span>
<span class="line"><span style="color:#81A1C1">    @</span><span style="color:#D8DEE9">story</span><span style="color:#81A1C1"> +=</span><span style="color:#ECEFF4"> '</span><span style="color:#A3BE8C"> and ate some grass</span><span style="color:#ECEFF4">'</span></span>
<span class="line"><span style="color:#81A1C1">    self</span></span>
<span class="line"><span style="color:#81A1C1">  end</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1">  def</span><span style="color:#88C0D0"> the_end</span></span>
<span class="line"><span style="color:#81A1C1">    @</span><span style="color:#D8DEE9">story</span></span>
<span class="line"><span style="color:#81A1C1">  end</span></span>
<span class="line"><span style="color:#81A1C1">end</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8FBCBB">Bunny</span><span style="color:#ECEFF4">.</span><span style="color:#81A1C1">new</span><span style="color:#ECEFF4">(</span><span style="color:#ECEFF4">'</span><span style="color:#A3BE8C">Foofoo</span><span style="color:#ECEFF4">'</span><span style="color:#ECEFF4">)</span></span>
<span class="line"><span style="color:#ECEFF4">  .</span><span style="color:#D8DEE9FF">went_to_the_forest</span></span>
<span class="line"><span style="color:#ECEFF4">  .</span><span style="color:#D8DEE9FF">and_ate_some_grass</span></span>
<span class="line"><span style="color:#ECEFF4">  .</span><span style="color:#D8DEE9FF">the_end</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8FBCBB">Bunny</span><span style="color:#ECEFF4">.</span><span style="color:#81A1C1">new</span><span style="color:#ECEFF4">(</span><span style="color:#ECEFF4">'</span><span style="color:#A3BE8C">Booboo</span><span style="color:#ECEFF4">'</span><span style="color:#ECEFF4">)</span></span>
<span class="line"><span style="color:#ECEFF4">  .</span><span style="color:#D8DEE9FF">went_to_the_forest</span></span>
<span class="line"><span style="color:#ECEFF4">  .</span><span style="color:#D8DEE9FF">the_end</span></span>
<span class="line"></span></code></pre><!----> <p>Which is actually pretty great in terms of readability. But what if there’s another ending, which this class doesn’t know about?</p> <!----><pre class="shiki nord" style="background-color:#2e3440ff;color:#d8dee9ff" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="color:#81A1C1">def</span><span style="color:#88C0D0"> new_ending</span><span style="color:#ECEFF4">(</span><span style="color:#D8DEE9">story</span><span style="color:#ECEFF4">)</span></span>
<span class="line"><span style="color:#ECEFF4">  "</span><span style="color:#81A1C1">#&#123;</span><span style="color:#A3BE8C">story</span><span style="color:#81A1C1">&#125;</span><span style="color:#A3BE8C"> and then gets eaten by a fox!</span><span style="color:#ECEFF4">"</span></span>
<span class="line"><span style="color:#81A1C1">end</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9FF">new_ending</span><span style="color:#ECEFF4">(</span><span style="color:#8FBCBB">Bunny</span><span style="color:#ECEFF4">.</span><span style="color:#81A1C1">new</span><span style="color:#ECEFF4">(</span><span style="color:#ECEFF4">'</span><span style="color:#A3BE8C">Booboo</span><span style="color:#ECEFF4">'</span><span style="color:#ECEFF4">)</span></span>
<span class="line"><span style="color:#ECEFF4">  .</span><span style="color:#D8DEE9FF">went_to_the_forest</span></span>
<span class="line"><span style="color:#ECEFF4">  .</span><span style="color:#D8DEE9FF">the_end</span><span style="color:#ECEFF4">)</span></span>
<span class="line"></span></code></pre><!----> <p>The nice readability of our story in code is gone, especially if there’s more than one of these building blocks.</p> <p>But suppose we skip all this superstructure and use our original methods plus a small glue method in the data class?</p> <!----><pre class="shiki nord" style="background-color:#2e3440ff;color:#d8dee9ff" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="color:#81A1C1">class</span><span style="color:#8FBCBB"> String</span></span>
<span class="line"><span style="color:#81A1C1">  def</span><span style="color:#88C0D0"> |</span><span style="color:#ECEFF4">(</span><span style="color:#D8DEE9">fun</span><span style="color:#D8DEE9FF">, </span><span style="color:#81A1C1">*</span><span style="color:#D8DEE9">args</span><span style="color:#ECEFF4">)</span></span>
<span class="line"><span style="color:#D8DEE9FF">    method</span><span style="color:#ECEFF4">(</span><span style="color:#D8DEE9FF">fun</span><span style="color:#ECEFF4">).(</span><span style="color:#81A1C1">self</span><span style="color:#ECEFF4">,</span><span style="color:#81A1C1"> *</span><span style="color:#D8DEE9FF">args</span><span style="color:#ECEFF4">)</span></span>
<span class="line"><span style="color:#81A1C1">  end</span></span>
<span class="line"><span style="color:#81A1C1">end</span></span>
<span class="line"></span></code></pre><!----> <p>Voila:</p> <!----><pre class="shiki nord" style="background-color:#2e3440ff;color:#d8dee9ff" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="color:#ECEFF4">'</span><span style="color:#A3BE8C">Foofoo</span><span style="color:#ECEFF4">'</span><span style="color:#81A1C1"> |</span></span>
<span class="line"><span style="color:#ECEFF4">  :</span><span style="color:#D8DEE9FF">the_bunny </span><span style="color:#81A1C1">|</span></span>
<span class="line"><span style="color:#ECEFF4">  :</span><span style="color:#D8DEE9FF">went_to_the_forest </span><span style="color:#81A1C1">|</span></span>
<span class="line"><span style="color:#ECEFF4">  :</span><span style="color:#D8DEE9FF">and_ate_some_grass</span></span>
<span class="line"></span></code></pre><!----> <p>This doesn’t allow extra arguments, so if a method like <code>:the</code> took a parameter like <code>:bunny</code>, you couldn’t do <code>'Foofoo' | :the, :bunny</code>. You could accomplish this with <code>'Foofoo' .| :the, :bunny</code> (calling the operator directly), but this doesn’t work with the multiline format above. It’s an open question for me whether Ruby could be made to support this like elixir or clojure.</p><!----> <div class="mt-16"><a href="/blog" class="text-gray-500 hover:text-gray-700">← Back</a></div></article><!----><!----><!----><!--]--><!----><!----><!--]--> <!--[!--><!--]--><!--]-->
			
			<script>
				{
					__sveltekit_vh75ld = {
						base: new URL("..", location).pathname.slice(0, -1)
					};

					const element = document.currentScript.parentElement;

					const data = [null,null,null];

					Promise.all([
						import("../_app/immutable/entry/start.D98JGyVI.js"),
						import("../_app/immutable/entry/app.DBhn532W.js")
					]).then(([kit, app]) => {
						kit.start(app, element, {
							node_ids: [0, 2, 5],
							data,
							form: null,
							error: null
						});
					});
				}
			</script>
		</div>
	</body>
</html>
